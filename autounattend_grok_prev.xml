<unattend xmlns="urn:schemas-microsoft-com:unattend" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State">
    <settings pass="windowsPE">
        <component name="Microsoft-Windows-International-Core-WinPE" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <SetupUILanguage>
                <UILanguage>en-US</UILanguage>
            </SetupUILanguage>
            <InputLocale>0409:00000409;0419:00000419</InputLocale>
            <SystemLocale>en-US</SystemLocale>
            <UILanguage>en-US</UILanguage>
            <UserLocale>ru-KZ</UserLocale>
        </component>
        <component name="Microsoft-Windows-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <DiskConfiguration>
                <WillShowUI>OnError</WillShowUI>
            </DiskConfiguration>
            <ImageInstall>
                <OSImage>
                    <InstallFrom>
                        <MetaData wcm:action="add">
                            <Key>/IMAGE/NAME</Key>
                            <Value>Windows 11 Pro</Value>
                        </MetaData>
                    </InstallFrom>
                    <WillShowUI>OnError</WillShowUI>
                </OSImage>
            </ImageInstall>
            <UserData>
                <ProductKey>
                    <Key>W269N-WFGWX-YVC9B-4J6C9-T83GX</Key>
                </ProductKey>
                <AcceptEula>true</AcceptEula>
            </UserData>
            <RunSynchronous>
                <RunSynchronousCommand wcm:action="add">
                    <Order>1</Order>
                    <Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassTPMCheck /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>2</Order>
                    <Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassSecureBootCheck /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>3</Order>
                    <Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassRAMCheck /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>4</Order>
                    <Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassStorageCheck /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>5</Order>
                    <Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassCPUCheck /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>6</Order>
                    <Path>reg.exe add "HKLM\SYSTEM\Setup\LabConfig" /v BypassDiskCheck /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
            </RunSynchronous>
        </component>
    </settings>
    <settings pass="specialize">
        <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <ComputerName>SWR-PC</ComputerName>
            <ProductKey>W269N-WFGWX-YVC9B-4J6C9-T83GX</ProductKey>
            <TimeZone>Central Asia Standard Time</TimeZone>
        </component>
        <component name="Microsoft-Windows-Deployment" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
            <RunSynchronous>
                <RunSynchronousCommand wcm:action="add">
                    <Order>1</Order>
                    <Path>powershell.exe -WindowStyle Hidden -Command "$xml = [xml]::new(); $xml.Load('C:\Windows\Panther\unattend.xml'); $sb = [scriptblock]::Create($xml.unattend.Extensions.ExtractScript); Invoke-Command -ScriptBlock $sb -ArgumentList $xml;"</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>2</Order>
                    <Path>powershell.exe -WindowStyle Hidden -ExecutionPolicy Unrestricted -File "C:\Windows\Setup\Scripts\Specialize.ps1"</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>3</Order>
                    <Path>reg.exe add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\OOBE" /v BypassNRO /t REG_DWORD /d 1 /f</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>4</Order>
                    <Path>powershell.exe -WindowStyle Hidden -ExecutionPolicy Unrestricted -Command "Get-NetAdapter | Disable-NetAdapter -Confirm:$false"</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>5</Order>
                    <Path>net accounts /maxpwage:UNLIMITED</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Path>reg.exe load "HKU\DefaultUser" "C:\Users\Default\NTUSER.DAT"</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>6</Order>
                    <Path>powershell.exe -WindowStyle Hidden -ExecutionPolicy Unrestricted -File "C:\Windows\Setup\Scripts\DefaultUser.ps1"</Path>
                </RunSynchronousCommand>
                <RunSynchronousCommand wcm:action="add">
                    <Order>7</Order>
                    <Path>reg.exe unload "HKU\DefaultUser"</Path>
                </RunSynchronousCommand>
            </RunSynchronous>
        </component>
    </settings>
    <settings pass="oobeSystem">
        <component name="Microsoft-Windows-International-Core">
            <InputLocale>0409:00000409;0419:00000419</InputLocale>
            <SystemLocale>en-US</SystemLocale>
            <UILanguage>en-US</UILanguage>
            <UserLocale>ru-KZ</UserLocale>
        </component>
        <component name="Microsoft-Windows-Shell-Setup">
            <UserAccounts>
                <LocalAccounts>
                    <LocalAccount wcm:action="add">
                        <Name>SWR47</Name>
                        <Group>Administrators</Group>
                        <Password>
                            <Value>509490</Value>
                            <PlainText>true</PlainText>
                        </Password>
                    </LocalAccount>
                </LocalAccounts>
            </UserAccounts>
            <AutoLogon>
                <Username>SWR47</Username>
                <Enabled>true</Enabled>
                <LogonCount>1</LogonCount>
                <Password>
                    <Value>509490</Value>
                    <PlainText>true</PlainText>
                </Password>
            </AutoLogon>
            <OOBE>
                <ProtectYourPC>3</ProtectYourPC>
                <HideEULAPage>true</HideEULAPage>
                <HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
                <HideOnlineAccountScreens>false</HideOnlineAccountScreens>
            </OOBE>
            <FirstLogonCommands>
                <SynchronousCommand wcm:action="add">
                    <Order>1</Order>
                    <CommandLine>powershell.exe -WindowStyle Hidden -ExecutionPolicy Unrestricted -File "C:\Windows\Setup\Scripts\FirstLogon.ps1"</CommandLine>
                </SynchronousCommand>
                <SynchronousCommand wcm:action="add">
                    <Order>2</Order>
                    <CommandLine>powershell.exe -WindowStyle Hidden -ExecutionPolicy Unrestricted -File "C:\Windows\Setup\Scripts\UserOnce.ps1"</CommandLine>
                </SynchronousCommand>
            </FirstLogonCommands>
        </component>
    </settings>
    <Extensions xmlns="https://schneegans.de/windows/unattend-generator/">
        <ExtractScript>
param([xml]$Document);
foreach($file in $Document.unattend.Extensions.File){
    $path = [Environment]::ExpandEnvironmentVariables($file.GetAttribute('path'));
    mkdir -Path ($path | Split-Path -Parent) -ErrorAction SilentlyContinue;
    $encoding = switch([IO.Path]::GetExtension($path)){
        {$_ -in '.ps1','.xml'} {[Text.Encoding]::UTF8}
        {$_ -in '.reg','.vbs','.js'} {[Text.UnicodeEncoding]::new($false,$true)}
        default {[Text.Encoding]::Default}
    };
    $bytes = $encoding.GetPreamble() + $encoding.GetBytes($file.InnerText.Trim());
    [IO.File]::WriteAllBytes($path,$bytes);
}
        </ExtractScript>
        <File path="C:\Windows\Setup\Scripts\RemovePackages.ps1">
$LogPath = "C:\UnattendLogs\RemovePackages.log"
mkdir -Path "C:\UnattendLogs" -ErrorAction SilentlyContinue
function Write-Log {
    param([string]$Message, [string]$Level = "INFO")
    $Timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $LogEntry = "[$Timestamp] [$Level] $Message"
    Add-Content -Path $LogPath -Value $LogEntry -Encoding UTF8
}
$selectors = @('Microsoft.Microsoft3DViewer','Microsoft.BingSearch','Microsoft.WindowsCamera','Clipchamp.Clipchamp','Microsoft.Copilot','Microsoft.549981C3F5F10','MicrosoftCorporationII.MicrosoftFamily','Microsoft.Edge.GameAssist','Microsoft.GetHelp','Microsoft.Getstarted','microsoft.windowscommunicationsapps','Microsoft.WindowsMaps','Microsoft.MixedReality.Portal','Microsoft.BingNews','Microsoft.MicrosoftOfficeHub','Microsoft.Office.OneNote','Microsoft.OutlookForWindows','Microsoft.MSPaint','Microsoft.People','Microsoft.PowerAutomateDesktop','MicrosoftCorporationII.QuickAssist','Microsoft.SkypeApp','Microsoft.ScreenSketch','Microsoft.MicrosoftSolitaireCollection','Microsoft.MicrosoftStickyNotes','MicrosoftTeams','MSTeams','Microsoft.Todos','Microsoft.WindowsSoundRecorder','Microsoft.Wallet','Microsoft.Xbox.TCUI','Microsoft.XboxApp','Microsoft.XboxGameOverlay','Microsoft.XboxGamingOverlay','Microsoft.XboxIdentityProvider','Microsoft.XboxSpeechToTextOverlay','Microsoft.GamingApp','Microsoft.YourPhone','Microsoft.ZuneMusic','Microsoft.ZuneVideo');
function Remove-Packages {
    param([array]$selectors);
    $provisioned = Get-AppxProvisionedPackage -Online;
    $installed = Get-AppxPackage -AllUsers;
    $all = $provisioned + $installed | Sort-Object -Unique -Property DisplayName, PackageName;
    foreach ($package in $all) {
        foreach ($selector in $selectors) {
            if ($package.DisplayName -like $selector -or $package.PackageName -like $selector) {
                Write-Log "Removing $($package.DisplayName) ($($package.PackageName))" "INFO"
                if ($provisioned -contains $package) { Remove-AppxProvisionedPackage -Online -PackageName $package.PackageName 2>&1 | Out-Null; if ($?) { Write-Log "Provisioned removal success" "SUCCESS" } else { Write-Log "Provisioned removal failed" "ERROR" } }
                if ($installed -contains $package) { Remove-AppxPackage -AllUsers -PackageName $package.PackageName 2>&1 | Out-Null; if ($?) { Write-Log "Installed removal success" "SUCCESS" } else { Write-Log "Installed removal failed" "ERROR" } }
            }
        }
    }
}
Remove-Packages -selectors $selectors;
        </File>
        <File path="C:\Windows\Setup\Scripts\RemoveCapabilities.ps1">
$LogPath = "C:\UnattendLogs\RemoveCapabilities.log"
mkdir -Path "C:\UnattendLogs" -ErrorAction SilentlyContinue
function Write-Log {
    param([string]$Message, [string]$Level = "INFO")
    $Timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $LogEntry = "[$Timestamp] [$Level] $Message"
    Add-Content -Path $LogPath -Value $LogEntry -Encoding UTF8
}
$selectors = @('Print.Fax.Scan','Language.Handwriting','Browser.InternetExplorer','MathRecognizer','OneCoreUAP.OneSync','OpenSSH.Client','Microsoft.Windows.PowerShell.ISE','App.Support.QuickAssist','Microsoft.Windows.SnippingTool','Language.Speech','Language.TextToSpeech','App.StepsRecorder','Hello.Face.18967','Hello.Face.Migration.18967','Hello.Face.20134','Media.WindowsMediaPlayer');
function Remove-Capabilities {
    param([array]$selectors);
    $all = Get-WindowsCapability -Online;
    foreach ($capability in $all) {
        foreach ($selector in $selectors) {
            if ($capability.Name -like "*$selector*") {
                Write-Log "Removing $($capability.Name)" "INFO"
                Remove-WindowsCapability -Online -Name $capability.Name 2>&1 | Out-Null;
                if ($?) { Write-Log "Removal success" "SUCCESS" } else { Write-Log "Removal failed" "ERROR" }
            }
        }
    }
}
Remove-Capabilities -selectors $selectors;
        </File>
        <File path="C:\Windows\Setup\Scripts\RemoveFeatures.ps1">
$LogPath = "C:\UnattendLogs\RemoveFeatures.log"
mkdir -Path "C:\UnattendLogs" -ErrorAction SilentlyContinue
function Write-Log {
    param([string]$Message, [string]$Level = "INFO")
    $Timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $LogEntry = "[$Timestamp] [$Level] $Message"
    Add-Content -Path $LogPath -Value $LogEntry -Encoding UTF8
}
$selectors = @('MediaPlayback','Microsoft-RemoteDesktopConnection','Recall','Microsoft-SnippingTool');
function Remove-Features {
    param([array]$selectors);
    $all = Get-WindowsOptionalFeature -Online;
    foreach ($feature in $all) {
        foreach ($selector in $selectors) {
            if ($feature.FeatureName -like "*$selector*") {
                Write-Log "Removing $($feature.FeatureName)" "INFO"
                Disable-WindowsOptionalFeature -Online -FeatureName $feature.FeatureName -NoRestart 2>&1 | Out-Null;
                if ($?) { Write-Log "Removal success" "SUCCESS" } else { Write-Log "Removal failed" "ERROR" }
            }
        }
    }
}
Remove-Features -selectors $selectors;
        </File>
        <File path="C:\Windows\Setup\Scripts\SetStartPins.ps1">
reg add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Start" /v "PinnedList" /t REG_MULTI_SZ /d "" /f;
        </File>
        <File path="C:\Windows\Setup\Scripts\SetColorTheme.ps1">
reg add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize" /v "SystemUsesLightTheme" /t REG_DWORD /d 0 /f;
reg add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize" /v "AppsUseLightTheme" /t REG_DWORD /d 0 /f;
reg add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize" /v "ColorPrevalence" /t REG_DWORD /d 0 /f;
reg add "HKU\DefaultUser\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize" /v "EnableTransparency" /t REG_DWORD /d 1 /f;
reg add "HKU\DefaultUser\Software\Microsoft\Windows\DWM" /v "AccentColor" /t REG_DWORD /d 0xd47800 /f;
        </File>
        <File path="C:\Windows\Setup\Scripts\UserOnce.ps1">
$LogPath = "C:\UnattendLogs\UserOnce.log"
mkdir -Path "C:\UnattendLogs" -ErrorAction SilentlyContinue
function Write-Log {
    param([string]$Message, [string]$Level = "INFO")
    $Timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $LogEntry = "[$Timestamp] [$Level] $Message"
    Add-Content -Path $LogPath -Value $LogEntry -Encoding UTF8
}
Write-Log "Starting UserOnce.ps1" "INFO"
tzutil /s "Central Asia Standard Time"
if ($?) { Write-Log "Timezone set success" "SUCCESS" } else { Write-Log "Timezone set failed" "ERROR" }
Set-WinHomeLocation -GeoId 137
if ($?) { Write-Log "Home location set success" "SUCCESS" } else { Write-Log "Home location set failed" "ERROR" }
Get-AppxPackage *Copilot* -AllUsers | Remove-AppxPackage -AllUsers
if ($?) { Write-Log "Copilot removal success" "SUCCESS" } else { Write-Log "Copilot removal failed" "ERROR" }
Get-AppxProvisionedPackage -Online | Where-Object DisplayName -like *Copilot* | Remove-AppxProvisionedPackage -Online
if ($?) { Write-Log "Copilot provisioned removal success" "SUCCESS" } else { Write-Log "Copilot provisioned removal failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v LaunchTo /t REG_DWORD /d 1 /f
if ($?) { Write-Log "Explorer LaunchTo set success" "SUCCESS" } else { Write-Log "Explorer LaunchTo set failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Search" /v SearchboxTaskbarMode /t REG_DWORD /d 1 /f
if ($?) { Write-Log "SearchboxTaskbarMode set success" "SUCCESS" } else { Write-Log "SearchboxTaskbarMode set failed" "ERROR" }
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v HubMode /t REG_DWORD /d 1 /f
if ($?) { Write-Log "Hide Home set success" "SUCCESS" } else { Write-Log "Hide Home set failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{e25b5814-6e4b-4bd9-a1e8-3f3c3b5d7f3a}\PropertyBag" /v ThisPCPolicy /t REG_SZ /d Hide /f
if ($?) { Write-Log "Hide Gallery success" "SUCCESS" } else { Write-Log "Hide Gallery failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{f874310e-b6b7-47dc-bc84-b9e6b38f5903}\PropertyBag" /v ThisPCPolicy /t REG_SZ /d Hide /f
if ($?) { Write-Log "Hide Documents success" "SUCCESS" } else { Write-Log "Hide Documents failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{0ddd015d-b06c-45f4-8342-231c9a8041f5}\PropertyBag" /v ThisPCPolicy /t REG_SZ /d Hide /f
if ($?) { Write-Log "Hide Music success" "SUCCESS" } else { Write-Log "Hide Music failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FolderDescriptions\{A0C69A99-21C8-4671-8703-7934162fcf1d}\PropertyBag" /v ThisPCPolicy /t REG_SZ /d Hide /f
if ($?) { Write-Log "Hide Pictures success" "SUCCESS" } else { Write-Log "Hide Pictures failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Icons" /v 29 /t REG_SZ /d "%SYSTEMROOT%\System32\shell32.dll,-50" /f
if ($?) { Write-Log "Shortcut arrow removal success" "SUCCESS" } else { Write-Log "Shortcut arrow removal failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer" /v link /t REG_BINARY /d 00000000 /f
if ($?) { Write-Log "Shortcut suffix removal success" "SUCCESS" } else { Write-Log "Shortcut suffix removal failed" "ERROR" }
Set-WindowsReservedStorageState -State Disabled
if ($?) { Write-Log "Reserved storage disabled success" "SUCCESS" } else { Write-Log "Reserved storage disabled failed" "ERROR" }
powercfg /hibernate off
if ($?) { Write-Log "Hibernation off success" "SUCCESS" } else { Write-Log "Hibernation off failed" "ERROR" }
powercfg /setactive SCHEME_MIN
if ($?) { Write-Log "Power scheme min success" "SUCCESS" } else { Write-Log "Power scheme min failed" "ERROR" }
powercfg -change -disk-timeout-ac 0
if ($?) { Write-Log "Disk timeout AC 0 success" "SUCCESS" } else { Write-Log "Disk timeout AC 0 failed" "ERROR" }
powercfg -change -disk-timeout-dc 0
if ($?) { Write-Log "Disk timeout DC 0 success" "SUCCESS" } else { Write-Log "Disk timeout DC 0 failed" "ERROR" }
powercfg -change -standby-timeout-ac 0
if ($?) { Write-Log "Standby timeout AC 0 success" "SUCCESS" } else { Write-Log "Standby timeout AC 0 failed" "ERROR" }
powercfg -change -standby-timeout-dc 0
if ($?) { Write-Log "Standby timeout DC 0 success" "SUCCESS" } else { Write-Log "Standby timeout DC 0 failed" "ERROR" }
powercfg -setacvalueindex SCHEME_CURRENT SUB_SLEEP UNATTENDED 0
if ($?) { Write-Log "Unattended AC success" "SUCCESS" } else { Write-Log "Unattended AC failed" "ERROR" }
powercfg -setdcvalueindex SCHEME_CURRENT SUB_SLEEP UNATTENDED 0
if ($?) { Write-Log "Unattended DC success" "SUCCESS" } else { Write-Log "Unattended DC failed" "ERROR" }
Set-MpPreference -SubmitSamplesConsent 2
if ($?) { Write-Log "Defender SubmitSamplesConsent 2 success" "SUCCESS" } else { Write-Log "Defender SubmitSamplesConsent 2 failed" "ERROR" }
Set-MpPreference -DisableRealtimeMonitoring $true
if ($?) { Write-Log "DisableRealtimeMonitoring success" "SUCCESS" } else { Write-Log "DisableRealtimeMonitoring failed" "ERROR" }
Set-MpPreference -MAPSReporting 0
if ($?) { Write-Log "MAPSReporting 0 success" "SUCCESS" } else { Write-Log "MAPSReporting 0 failed" "ERROR" }
Set-MpPreference -PUAProtection 0
if ($?) { Write-Log "PUAProtection 0 success" "SUCCESS" } else { Write-Log "PUAProtection 0 failed" "ERROR" }
reg delete "HKCR\SystemFileAssociations\.bmp\Shell\print" /f 2>$null
if ($?) { Write-Log "Remove print bmp success" "SUCCESS" } else { Write-Log "Remove print bmp failed" "ERROR" }
reg delete "HKCR\SystemFileAssociations\.jpg\Shell\print" /f 2>$null
if ($?) { Write-Log "Remove print jpg success" "SUCCESS" } else { Write-Log "Remove print jpg failed" "ERROR" }
reg delete "HKCR\SystemFileAssociations\.png\Shell\print" /f 2>$null
if ($?) { Write-Log "Remove print png success" "SUCCESS" } else { Write-Log "Remove print png failed" "ERROR" }
reg delete "HKCR\SystemFileAssociations\.tif\Shell\print" /f 2>$null
if ($?) { Write-Log "Remove print tif success" "SUCCESS" } else { Write-Log "Remove print tif failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Shell Extensions\Blocked" /v "{f81e9010-6ea4-11da-a742-000bdbd316bd}" /t REG_SZ /d "" /f
if ($?) { Write-Log "Remove Give access success" "SUCCESS" } else { Write-Log "Remove Give access failed" "ERROR" }
reg add "HKLM\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" /v TdrDelay /t REG_DWORD /d 60 /f
if ($?) { Write-Log "TDR delay 60 success" "SUCCESS" } else { Write-Log "TDR delay 60 failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel" /v "{5399E694-6ce5-4d6c-8fce-1d6b36ee493d}" /t REG_DWORD /d 1 /f
if ($?) { Write-Log "Hide desktop icon 1 success" "SUCCESS" } else { Write-Log "Hide desktop icon 1 failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel" /v "{F02C1A0D-BE21-4350-88B0-7367fc96ef3c}" /t REG_DWORD /d 1 /f
if ($?) { Write-Log "Hide desktop icon 2 success" "SUCCESS" } else { Write-Log "Hide desktop icon 2 failed" "ERROR" }
reg add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v LongPathsEnabled /t REG_DWORD /d 1 /f
if ($?) { Write-Log "LongPathsEnabled success" "SUCCESS" } else { Write-Log "LongPathsEnabled failed" "ERROR" }
fsutil behavior set disablelastaccess 1
if ($?) { Write-Log "disablelastaccess success" "SUCCESS" } else { Write-Log "disablelastaccess failed" "ERROR" }
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v AllowUpgradesWithUnsupportedTPMOrCPU /t REG_DWORD /d 1 /f
if ($?) { Write-Log "AllowUpgradesWithUnsupportedTPMOrCPU success" "SUCCESS" } else { Write-Log "AllowUpgradesWithUnsupportedTPMOrCPU failed" "ERROR" }
taskkill /f /im OneDrive.exe 2>$null
if ($?) { Write-Log "OneDrive kill success" "SUCCESS" } else { Write-Log "OneDrive kill failed" "ERROR" }
%SystemRoot%\SysWOW64\OneDriveSetup.exe /uninstall 2>$null
if ($?) { Write-Log "OneDrive uninstall success" "SUCCESS" } else { Write-Log "OneDrive uninstall failed" "ERROR" }
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\OneDrive" /v DisableFileSyncNGSC /t REG_DWORD /d 1 /f
if ($?) { Write-Log "OneDrive DisableFileSyncNGSC success" "SUCCESS" } else { Write-Log "OneDrive DisableFileSyncNGSC failed" "ERROR" }
reg add "HKLM\SYSTEM\CurrentControlSet\Services\RemoteAccess" /v fAllowToGetHelp /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Remote assistance off success" "SUCCESS" } else { Write-Log "Remote assistance off failed" "ERROR" }
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Chat" /v ConfigureChatAutoInstall /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Chat auto install off success" "SUCCESS" } else { Write-Log "Chat auto install off failed" "ERROR" }
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Security\VerifiedAndReputablePolicyState" /t REG_DWORD /d 0 /f
if ($?) { Write-Log "VerifiedAndReputablePolicyState off success" "SUCCESS" } else { Write-Log "VerifiedAndReputablePolicyState off failed" "ERROR" }
Set-ExecutionPolicy -Scope LocalMachine -ExecutionPolicy RemoteSigned -Force
if ($?) { Write-Log "ExecutionPolicy RemoteSigned success" "SUCCESS" } else { Write-Log "ExecutionPolicy RemoteSigned failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\AdvertisingInfo" /v Enabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "AdvertisingInfo off success" "SUCCESS" } else { Write-Log "AdvertisingInfo off failed" "ERROR" }
reg add "HKCU\Control Panel\International\User Profile" /v HttpAcceptLanguageOptOut /t REG_DWORD /d 1 /f
if ($?) { Write-Log "HttpAcceptLanguageOptOut success" "SUCCESS" } else { Write-Log "HttpAcceptLanguageOptOut failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_TrackProgs /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Start_TrackProgs off success" "SUCCESS" } else { Write-Log "Start_TrackProgs off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-338393Enabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "SubscribedContent-338393Enabled off success" "SUCCESS" } else { Write-Log "SubscribedContent-338393Enabled off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-353694Enabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "SubscribedContent-353694Enabled off success" "SUCCESS" } else { Write-Log "SubscribedContent-353694Enabled off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-353696Enabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "SubscribedContent-353696Enabled off success" "SUCCESS" } else { Write-Log "SubscribedContent-353696Enabled off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Narrator\NoRoam" /v OnlineServicesEnabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Narrator OnlineServicesEnabled off success" "SUCCESS" } else { Write-Log "Narrator OnlineServicesEnabled off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Narrator\NoRoam" /v ScriptingEnabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Narrator ScriptingEnabled off success" "SUCCESS" } else { Write-Log "Narrator ScriptingEnabled off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Personalization\Settings" /v AcceptedPrivacyPolicy /t REG_DWORD /d 1 /f
if ($?) { Write-Log "AcceptedPrivacyPolicy success" "SUCCESS" } else { Write-Log "AcceptedPrivacyPolicy failed" "ERROR" }
reg add "HKCU\Software\Microsoft\InputPersonalization" /v RestrictImplicitTextCollection /t REG_DWORD /d 0 /f
if ($?) { Write-Log "RestrictImplicitTextCollection success" "SUCCESS" } else { Write-Log "RestrictImplicitTextCollection failed" "ERROR" }
reg add "HKCU\Software\Microsoft\InputPersonalization\TrainedDataStore" /v HarvestContacts /t REG_DWORD /d 1 /f
if ($?) { Write-Log "HarvestContacts success" "SUCCESS" } else { Write-Log "HarvestContacts failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Diagnostics\DiagTrack" /v ShowedToastAtLevel /t REG_DWORD /d 1 /f
if ($?) { Write-Log "DiagTrack ShowedToastAtLevel success" "SUCCESS" } else { Write-Log "DiagTrack ShowedToastAtLevel failed" "ERROR" }
reg add "HKCU\SOFTWARE\Policies\Microsoft\Windows\DataCollection" /v AllowTelemetry /t REG_DWORD /d 1 /f
if ($?) { Write-Log "AllowTelemetry 1 success" "SUCCESS" } else { Write-Log "AllowTelemetry 1 failed" "ERROR" }
reg add "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" /v AllowTelemetry /t REG_DWORD /d 1 /f
if ($?) { Write-Log "DataCollection AllowTelemetry 1 success" "SUCCESS" } else { Write-Log "DataCollection AllowTelemetry 1 failed" "ERROR" }
reg add "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" /v MaxTelemetryAllowed /t REG_DWORD /d 1 /f
if ($?) { Write-Log "MaxTelemetryAllowed 1 success" "SUCCESS" } else { Write-Log "MaxTelemetryAllowed 1 failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Privacy" /v TailoredExperiencesWithDiagnosticDataEnabled /t REG_DWORD /d 2 /f
if ($?) { Write-Log "TailoredExperiencesWithDiagnosticDataEnabled 2 success" "SUCCESS" } else { Write-Log "TailoredExperiencesWithDiagnosticDataEnabled 2 failed" "ERROR" }
reg add "HKCU\SOFTWARE\Policies\Microsoft\Windows\DataCollection" /v DoNotShowFeedbackNotifications /t REG_DWORD /d 1 /f
if ($?) { Write-Log "DoNotShowFeedbackNotifications success" "SUCCESS" } else { Write-Log "DoNotShowFeedbackNotifications failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\SearchSettings" /v IsMSACloudSearchEnabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "IsMSACloudSearchEnabled off success" "SUCCESS" } else { Write-Log "IsMSACloudSearchEnabled off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\SearchSettings" /v IsAADCloudSearchEnabled /t REG_DWORD /d 0 /f
if ($?) { Write-Log "IsAADCloudSearchEnabled off success" "SUCCESS" } else { Write-Log "IsAADCloudSearchEnabled off failed" "ERROR" }
reg add "HKCU\SOFTWARE\Policies\Microsoft\Windows\Windows Search" /v AllowCortana /t REG_DWORD /d 0 /f
if ($?) { Write-Log "AllowCortana off success" "SUCCESS" } else { Write-Log "AllowCortana off failed" "ERROR" }
reg add "HKCU\SOFTWARE\Policies\Microsoft\OneDrive" /v KFMBlockOptIn /t REG_DWORD /d 1 /f
if ($?) { Write-Log "OneDrive KFMBlockOptIn success" "SUCCESS" } else { Write-Log "OneDrive KFMBlockOptIn failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer" /v ShowRecent /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowRecent off success" "SUCCESS" } else { Write-Log "ShowRecent off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer" /v ShowRecommendations /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowRecommendations off success" "SUCCESS" } else { Write-Log "ShowRecommendations off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer" /v ShowFrequent /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowFrequent off success" "SUCCESS" } else { Write-Log "ShowFrequent off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer" /v ShowCloudFilesInQuickAccess /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowCloudFilesInQuickAccess off success" "SUCCESS" } else { Write-Log "ShowCloudFilesInQuickAccess off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v UseCompactMode /t REG_DWORD /d 1 /f
if ($?) { Write-Log "UseCompactMode success" "SUCCESS" } else { Write-Log "UseCompactMode failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowTypeOverlay /t REG_DWORD /d 1 /f
if ($?) { Write-Log "ShowTypeOverlay success" "SUCCESS" } else { Write-Log "ShowTypeOverlay failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\CabinetState" /v FullPath /t REG_DWORD /d 0 /f
if ($?) { Write-Log "FullPath off success" "SUCCESS" } else { Write-Log "FullPath off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowSuperHidden /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowSuperHidden off success" "SUCCESS" } else { Write-Log "ShowSuperHidden off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v SeparateProcess /t REG_DWORD /d 1 /f
if ($?) { Write-Log "SeparateProcess success" "SUCCESS" } else { Write-Log "SeparateProcess failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v PersistBrowsers /t REG_DWORD /d 1 /f
if ($?) { Write-Log "PersistBrowsers success" "SUCCESS" } else { Write-Log "PersistBrowsers failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowEncryptCompressedColor /t REG_DWORD /d 1 /f
if ($?) { Write-Log "ShowEncryptCompressedColor success" "SUCCESS" } else { Write-Log "ShowEncryptCompressedColor failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowInfoTip /t REG_DWORD /d 1 /f
if ($?) { Write-Log "ShowInfoTip success" "SUCCESS" } else { Write-Log "ShowInfoTip failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowStatusBar /t REG_DWORD /d 1 /f
if ($?) { Write-Log "ShowStatusBar success" "SUCCESS" } else { Write-Log "ShowStatusBar failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v AutoCheckSelect /t REG_DWORD /d 0 /f
if ($?) { Write-Log "AutoCheckSelect off success" "SUCCESS" } else { Write-Log "AutoCheckSelect off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v SharingWizardOn /t REG_DWORD /d 0 /f
if ($?) { Write-Log "SharingWizardOn off success" "SUCCESS" } else { Write-Log "SharingWizardOn off failed" "ERROR" }
reg add "HKCU\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v HideRecommendedSection /t REG_DWORD /d 1 /f
if ($?) { Write-Log "HideRecommendedSection success" "SUCCESS" } else { Write-Log "HideRecommendedSection failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Start" /v ShowAllPinsList /t REG_DWORD /d 1 /f
if ($?) { Write-Log "ShowAllPinsList success" "SUCCESS" } else { Write-Log "ShowAllPinsList failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Start" /v ShowRecentList /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowRecentList off success" "SUCCESS" } else { Write-Log "ShowRecentList off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Start" /v ShowFrequentList /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowFrequentList off success" "SUCCESS" } else { Write-Log "ShowFrequentList off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_TrackDocs /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Start_TrackDocs off success" "SUCCESS" } else { Write-Log "Start_TrackDocs off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Start_IrisRecommendations /t REG_DWORD /d 0 /f
if ($?) { Write-Log "Start_IrisRecommendations off success" "SUCCESS" } else { Write-Log "Start_IrisRecommendations off failed" "ERROR" }
reg add "HKCU\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v DisableSearchBoxSuggestions /t REG_DWORD /d 1 /f
if ($?) { Write-Log "DisableSearchBoxSuggestions success" "SUCCESS" } else { Write-Log "DisableSearchBoxSuggestions failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v TaskbarAl /t REG_DWORD /d 0 /f
if ($?) { Write-Log "TaskbarAl left success" "SUCCESS" } else { Write-Log "TaskbarAl left failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowTaskViewButton /t REG_DWORD /d 0 /f
if ($?) { Write-Log "ShowTaskViewButton off success" "SUCCESS" } else { Write-Log "ShowTaskViewButton off failed" "ERROR" }
reg add "HKCU\Software\Policies\Microsoft\Dsh" /v AllowNewsAndInterests /t REG_DWORD /d 0 /f
if ($?) { Write-Log "AllowNewsAndInterests off success" "SUCCESS" } else { Write-Log "AllowNewsAndInterests off failed" "ERROR" }
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\TaskbarDeveloperSettings" /v TaskbarEndTask /t REG_DWORD /d 1 /f
if ($?) { Write-Log "TaskbarEndTask on success" "SUCCESS" } else { Write-Log "TaskbarEndTask on failed" "ERROR" }
winget source update --name winget
if ($?) { Write-Log "winget source update success" "SUCCESS" } else { Write-Log "winget source update failed" "ERROR" }
winget install --id 7zip.7zip --silent --accept-package-agreements --accept-source-agreements
if ($?) { Write-Log "7zip install success" "SUCCESS" } else { Write-Log "7zip install failed" "ERROR" }
winget install --id Brave.Brave --silent --accept-package-agreements --accept-source-agreements
if ($?) { Write-Log "Brave install success" "SUCCESS" } else { Write-Log "Brave install failed" "ERROR" }
winget install --id Google.Chrome --silent --accept-package-agreements --accept-source-agreements
if ($?) { Write-Log "Chrome install success" "SUCCESS" } else { Write-Log "Chrome install failed" "ERROR" }
winget install --id Mozilla.Firefox.Nightly --silent --accept-package-agreements --accept-source-agreements
if ($?) { Write-Log "Firefox Nightly install success" "SUCCESS" } else { Write-Log "Firefox Nightly install failed" "ERROR" }
Invoke-WebRequest -Uri "https://aka.ms/vs/17/release/vc_redist.x64.exe" -OutFile "$env:TEMP\vc_redist.x64.exe" -UseBasicParsing
if ($?) { Write-Log "VC++ download success" "SUCCESS" } else { Write-Log "VC++ download failed" "ERROR" }
Start-Process "$env:TEMP\vc_redist.x64.exe" -ArgumentList "/quiet /norestart" -Wait
if ($?) { Write-Log "VC++ install success" "SUCCESS" } else { Write-Log "VC++ install failed" "ERROR" }
$terminalUrl = "https://github.com/microsoft/terminal/releases/latest/download/Microsoft.WindowsTerminal.msixbundle"
Invoke-WebRequest -Uri $terminalUrl -OutFile "$env:TEMP\Terminal.msixbundle" -UseBasicParsing
if ($?) { Write-Log "Terminal download success" "SUCCESS" } else { Write-Log "Terminal download failed" "ERROR" }
Add-AppxPackage -Path "$env:TEMP\Terminal.msixbundle"
if ($?) { Write-Log "Terminal install success" "SUCCESS" } else { Write-Log "Terminal install failed" "ERROR" }
foreach($d in 'C','D','E','F','G','H','I','J','K'){$src=Join-Path ($d+':') 'sources\sxs';if(Test-Path $src\*.cab){dism /Online /Enable-Feature /FeatureName:NetFx3 /All /LimitAccess /Source:$src;break}}
if ($?) { Write-Log ".NET 3.5 enable success" "SUCCESS" } else { Write-Log ".NET 3.5 enable failed" "ERROR" }
$vivetoolZip = "$env:TEMP\ViVeTool.zip"
$release = Invoke-WebRequest -Uri "https://api.github.com/repos/thebookisclosed/ViVe/releases/latest" -UseBasicParsing | ConvertFrom-Json
$vivetoolUrl = $release.assets.browser_download_url | Where-Object { $_ -like "*.zip" } | Select-Object -First 1
Invoke-WebRequest -Uri $vivetoolUrl -OutFile $vivetoolZip
if ($?) { Write-Log "ViveTool download success" "SUCCESS" } else { Write-Log "ViveTool download failed" "ERROR" }
Expand-Archive $vivetoolZip "$env:TEMP\ViVeTool" -Force
if ($?) { Write-Log "ViveTool extract success" "SUCCESS" } else { Write-Log "ViveTool extract failed" "ERROR" }
& "$env:TEMP\ViVeTool\ViVeTool.exe" /enable /id:49402389,49221331,58988972,59265307,47205210,58989002,48433719,57118881,58381341,58527096,57156807,57259990,41118774,55805655,58778013,58383338,59270880,59203365,57703775 > "$env:TEMP\vivetool.log"
if ($?) { Write-Log "ViveTool enable success" "SUCCESS" } else { Write-Log "ViveTool enable failed - check C:\UnattendLogs\vivetool.log" "ERROR" }
Remove-Item "$env:TEMP\ViVeTool" -Recurse -Force 2>$null
Remove-Item "$env:TEMP\*.zip" -Force 2>$null
Remove-Item "$env:TEMP\*.exe" -Force 2>$null
Remove-Item "$env:TEMP\*.msixbundle" -Force 2>$null
Write-Log "UserOnce.ps1 completed" "INFO"
        </File>
    </Extensions>
</unattend>